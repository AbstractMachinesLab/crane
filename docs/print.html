<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>⚡ Zap Manual</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="⚡ Zap is a build system built for the modern polyglot teams.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
              <h2 style="margin-top: 1rem;">
                ⚡ Zap Manual
              </h2>
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting-started/installation.html"><strong aria-hidden="true">2.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="getting-started/first-steps.html"><strong aria-hidden="true">2.2.</strong> First steps</a></li><li class="chapter-item expanded "><a href="getting-started/how-zap-works.html"><strong aria-hidden="true">2.3.</strong> How Zap Works</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="guides/index.html"><strong aria-hidden="true">3.</strong> Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="guides/mix.html"><strong aria-hidden="true">3.1.</strong> Migrating from mix</a></li><li class="chapter-item expanded "><a href="guides/rebar3.html"><strong aria-hidden="true">3.2.</strong> Migrating from rebar3</a></li><li class="chapter-item expanded "><a href="guides/custom-rules.html"><strong aria-hidden="true">3.3.</strong> Writing custom Rules</a></li></ol></li><li class="chapter-item expanded "><a href="examples/index.html"><strong aria-hidden="true">4.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/hello-world.html"><strong aria-hidden="true">4.1.</strong> Hello World in Erlang / Elixir</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="ref/index.html"><strong aria-hidden="true">5.</strong> Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/cli.html"><strong aria-hidden="true">5.1.</strong> Zap CLI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/cli/default.html"><strong aria-hidden="true">5.1.1.</strong> zap</a></li><li class="chapter-item expanded "><a href="ref/cli/build.html"><strong aria-hidden="true">5.1.2.</strong> zap build</a></li><li class="chapter-item expanded "><a href="ref/cli/cache.html"><strong aria-hidden="true">5.1.3.</strong> zap cache</a></li><li class="chapter-item expanded "><a href="ref/cli/depgraph.html"><strong aria-hidden="true">5.1.4.</strong> zap depgraph</a></li><li class="chapter-item expanded "><a href="ref/cli/rules.html"><strong aria-hidden="true">5.1.5.</strong> zap rules</a></li><li class="chapter-item expanded "><a href="ref/cli/target.html"><strong aria-hidden="true">5.1.6.</strong> zap target</a></li><li class="chapter-item expanded "><a href="ref/cli/toolchain.html"><strong aria-hidden="true">5.1.7.</strong> zap toolchain</a></li><li class="chapter-item expanded "><a href="ref/cli/workspace.html"><strong aria-hidden="true">5.1.8.</strong> zap workspace</a></li></ol></li><li class="chapter-item expanded "><a href="ref/workspace.html"><strong aria-hidden="true">5.2.</strong> Workspace</a></li><li class="chapter-item expanded "><a href="ref/rules.html"><strong aria-hidden="true">5.3.</strong> Rules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/rules/archive.html"><strong aria-hidden="true">5.3.1.</strong> archive</a></li><li class="chapter-item expanded "><a href="ref/rules/deno_binary.html"><strong aria-hidden="true">5.3.2.</strong> deno_binary</a></li><li class="chapter-item expanded "><a href="ref/rules/deno_image.html"><strong aria-hidden="true">5.3.3.</strong> deno_image</a></li><li class="chapter-item expanded "><a href="ref/rules/deno_repl.html"><strong aria-hidden="true">5.3.4.</strong> deno_repl</a></li><li class="chapter-item expanded "><a href="ref/rules/erlang_application.html"><strong aria-hidden="true">5.3.5.</strong> erlang_application</a></li><li class="chapter-item expanded "><a href="ref/rules/erlang_image.html"><strong aria-hidden="true">5.3.6.</strong> erlang_image</a></li><li class="chapter-item expanded "><a href="ref/rules/erlang_library.html"><strong aria-hidden="true">5.3.7.</strong> erlang_library</a></li><li class="chapter-item expanded "><a href="ref/rules/erlang_release.html"><strong aria-hidden="true">5.3.8.</strong> erlang_release</a></li><li class="chapter-item expanded "><a href="ref/rules/erlang_shell.html"><strong aria-hidden="true">5.3.9.</strong> erlang_shell</a></li><li class="chapter-item expanded "><a href="ref/rules/file_group.html"><strong aria-hidden="true">5.3.10.</strong> file_group</a></li></ol></li><li class="chapter-item expanded "><a href="ref/toolchains.html"><strong aria-hidden="true">5.4.</strong> Toolchains</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/toolchains/deno.html"><strong aria-hidden="true">5.4.1.</strong> deno</a></li><li class="chapter-item expanded "><a href="ref/toolchains/docker.html"><strong aria-hidden="true">5.4.2.</strong> docker</a></li><li class="chapter-item expanded "><a href="ref/toolchains/elixir.html"><strong aria-hidden="true">5.4.3.</strong> elixir</a></li><li class="chapter-item expanded "><a href="ref/toolchains/erlang.html"><strong aria-hidden="true">5.4.4.</strong> erlang</a></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><a href="contrib/index.html"><strong aria-hidden="true">6.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contrib/building.html"><strong aria-hidden="true">6.1.</strong> Building from Source</a></li><li class="chapter-item expanded "><a href="contrib/styleguide.html"><strong aria-hidden="true">6.2.</strong> Style guide</a></li><li class="chapter-item expanded "><a href="contrib/architecture.html"><strong aria-hidden="true">6.3.</strong> Architecutre</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">⚡ Zap Manual</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/AbstractMachinesLab/zap" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>⚡ Zap is a build system built for the modern polyglot teams.</p>
<p>It's built on Deno and Rust.</p>
<h2><a class="header" href="#features" id="features">Features</a></h2>
<ul>
<li>Fast by default. Every build action is cached and reused, and all builds are
reproducible.</li>
<li>Ships only a single executable.</li>
<li>Designed to be extended. New rules and toolchains can be written quickly and
easily in Javascript.</li>
<li>Automatically manages language installations per project for you.</li>
</ul>
<h2><a class="header" href="#philosophy" id="philosophy">Philosophy</a></h2>
<p>Zap aims to make working with polyglot monorepos productive and easy.</p>
<p>Monorepos are great for large polyglot codebases, but the tooling to work
efficiently with them is either ecosystem specific (Dune, Lerna), or requires a
large effort upfront (Bazel, Pants, Buck).</p>
<p>Zap aims to be a drop-in solution.</p>
<h2><a class="header" href="#goals" id="goals">Goals</a></h2>
<ul>
<li>Only ship a single executable (<code>zap</code>)</li>
<li>Provide a simple, fast, and unified experience for polyglot monorepos:
<ul>
<li>manage language and dependency versions per project</li>
<li>build, test, and distribute polyglot projects</li>
</ul>
</li>
<li>Never hear &quot;it works on my machine&quot; again</li>
<li>Extending it with Toolchains and Rules should be easy</li>
</ul>
<h2><a class="header" href="#comparisons" id="comparisons">Comparisons</a></h2>
<h3><a class="header" href="#zap-and-rebar3" id="zap-and-rebar3">Zap and rebar3</a></h3>
<h3><a class="header" href="#zap-and-mix" id="zap-and-mix">Zap and mix</a></h3>
<h1><a class="header" href="#getting-started" id="getting-started">Getting Started</a></h1>
<h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<h1><a class="header" href="#first-steps" id="first-steps">First steps</a></h1>
<h1><a class="header" href="#how-zap-works" id="how-zap-works">How Zap Works</a></h1>
<blockquote>
<p>NOTE: you do not need to be familiar with Rules and Toolchains to <em>use</em> Zap,
but understanding them can help you use it more efficiently.</p>
</blockquote>
<p>There's only a handful of things to get familiar with that will help us
understand how to use Zap more effectively.</p>
<p>These are mirroring concepts that the Bazel build tool has already proven to
work at scale, but they are coloured with the flavors of Dune, that provides an
instant set up.</p>
<p>They are 5:</p>
<ul>
<li>Workspace</li>
<li>Package</li>
<li>Target</li>
<li>Rule</li>
<li>Toolchain</li>
</ul>
<h3><a class="header" href="#workspace" id="workspace">Workspace</a></h3>
<p>This is the dir in your filesystem with all of your project(s) source code.
Typically, this will be your entire Git repository.</p>
<p>Normally you'll have a <code>Workspace.toml</code> file at the root of your repo. We refer
to this as the &quot;workspace root&quot;.</p>
<h3><a class="header" href="#package" id="package">Package</a></h3>
<p>Code is organized in <em>packages</em>, which are named collections
of source files and rules on how to build them. These rules may specify
dependencies on other packages.</p>
<p>1 Package corresponds to 1 <code>Build.toml</code> file.</p>
<p>As an example, the following structure defines 2 packages using their local
paths from the Workspace root.</p>
<ol>
<li><code>//my/app</code>, and</li>
<li><code>//my/app/test</code></li>
</ol>
<pre><code>&lt;workspace root&gt;
├── Workspace.toml
└── my
  └── app
    ├── Build.toml
    ├── data
    ├── main.ex
    └── test
      ├── Build.toml
      └── main_test.exs
</code></pre>
<p>You have full control on how you organize packages so it can best reflect
the structure of your project(s).</p>
<p>The more granular packages you have, the faster incremental rebuilds can be.</p>
<h3><a class="header" href="#target" id="target">Target</a></h3>
<p>As we saw above, every Package has a number of named definitions. These we call
<em>Targets</em> and they represent the specific things being built or run within a
Package.</p>
<p>A target always consists of 2 things:</p>
<ul>
<li>a <code>rule</code>, and</li>
<li>a <code>name</code>,</li>
</ul>
<p>Depending on the <code>rule</code>, the target may have more parameters.</p>
<p>For example, library targets have tend to have sources (<code>srcs</code>), while test
targets have a single source (<code>src</code>). All rules have ecosystem aware defaults.</p>
<p>Here's an Elixir library and its corresponding test, also written in Elixir.</p>
<pre><code class="language-toml"># file: &lt;workspace-root&gt;/my/app/Build.toml
[[elixir_library]]
name = &quot;lib&quot;
srcs = [ &quot;*.ex&quot; ]  # this isn't needed, as it is the default

# file: &lt;workspace-root&gt;/my/app/test/Build.toml
[[elixir_test]]
name = &quot;main_test&quot;
src = &quot;main_test.exs&quot;
deps = [&quot;:lib&quot;]
</code></pre>
<p>The <code>name</code> of a target defines its <strong>Label</strong>. Label's are package paths, as
we saw above, with the target name at the end.</p>
<p>In this case, because the package path of the library is
<code>&lt;workspace-root&gt;/my/app</code>, the Label will be <code>//my/app:lib</code>.</p>
<p>We use <code>//</code> as a shorthand for <code>&lt;workspace-root&gt;</code>.</p>
<h3><a class="header" href="#rules" id="rules">Rules</a></h3>
<p>Rules define how to go from a set of inputs to a set of outputs. The name of
the rule defines what actions will be taken.</p>
<p>So for example, an <code>[[elixir_library]]</code> rule will be different from an
<code>[[gleam_library]]</code> rule, even if they both create the same set of outputs.</p>
<p>We're following a pattern of naming that prefixes common rules with the
language they support:</p>
<ul>
<li><code>*_library</code> for library</li>
<li><code>*_test</code> for tests</li>
<li><code>*_shell</code> for REPLs (whenever available)</li>
</ul>
<p>Which yields:</p>
<ul>
<li><code>erlang_library</code>, <code>elixir_library</code>, etc</li>
<li><code>erlang_test</code>, <code>elixir_test</code>, etc</li>
<li><code>erlang_shell</code>, <code>elixir_shell</code>, etc</li>
</ul>
<h3><a class="header" href="#toolchains" id="toolchains">Toolchains</a></h3>
<p>Many rules share certain tools to perform their work. For example, all the
Elixir rules need a working Elixir installation.</p>
<p>It would be too much work to specify that every target depends <em>also</em> on the
specific language toolchain, so instead we deal with this at the Rule level.</p>
<p>All rules define what toolchains they rely on, and Zap will build and cache
them like any other target.</p>
<h1><a class="header" href="#guides" id="guides">Guides</a></h1>
<h1><a class="header" href="#migrating-from-mix" id="migrating-from-mix">Migrating from mix</a></h1>
<h1><a class="header" href="#migrating-from-rebar3" id="migrating-from-rebar3">Migrating from Rebar3</a></h1>
<h1><a class="header" href="#writing-custom-rules" id="writing-custom-rules">Writing custom Rules</a></h1>
<h1><a class="header" href="#examples" id="examples">Examples</a></h1>
<h1><a class="header" href="#hello-world" id="hello-world">Hello World</a></h1>
<h1><a class="header" href="#reference" id="reference">Reference</a></h1>
<h1><a class="header" href="#zap-cli" id="zap-cli">Zap CLI</a></h1>
<h1><a class="header" href="#zap" id="zap">zap</a></h1>
<h1><a class="header" href="#zap-build-target" id="zap-build-target">zap build [target]</a></h1>
<h1><a class="header" href="#zap-cache" id="zap-cache">zap cache</a></h1>
<h1><a class="header" href="#zap-depgraph" id="zap-depgraph">zap depgraph</a></h1>
<h1><a class="header" href="#zap-rules" id="zap-rules">zap rules</a></h1>
<h1><a class="header" href="#zap-target" id="zap-target">zap target</a></h1>
<h1><a class="header" href="#zap-toolchain" id="zap-toolchain">zap toolchain</a></h1>
<h1><a class="header" href="#zap-workspace" id="zap-workspace">zap workspace</a></h1>
<h1><a class="header" href="#workspace-1" id="workspace-1">Workspace</a></h1>
<h1><a class="header" href="#rules-1" id="rules-1">Rules</a></h1>
<h1><a class="header" href="#archive" id="archive">archive</a></h1>
<h1><a class="header" href="#deno_binary" id="deno_binary">deno_binary</a></h1>
<h1><a class="header" href="#deno_image" id="deno_image">deno_image</a></h1>
<h1><a class="header" href="#deno_repl" id="deno_repl">deno_repl</a></h1>
<h1><a class="header" href="#erlang_application" id="erlang_application">erlang_application</a></h1>
<h1><a class="header" href="#erlang_image" id="erlang_image">erlang_image</a></h1>
<h1><a class="header" href="#erlang_library" id="erlang_library">erlang_library</a></h1>
<h1><a class="header" href="#erlang_release" id="erlang_release">erlang_release</a></h1>
<h1><a class="header" href="#erlang_shell" id="erlang_shell">erlang_shell</a></h1>
<h1><a class="header" href="#file_group" id="file_group">file_group</a></h1>
<h1><a class="header" href="#toolchains-1" id="toolchains-1">Toolchains</a></h1>
<h1><a class="header" href="#deno" id="deno">deno</a></h1>
<h1><a class="header" href="#docker" id="docker">docker</a></h1>
<h1><a class="header" href="#elixir" id="elixir">elixir</a></h1>
<h1><a class="header" href="#clojerl" id="clojerl">clojerl</a></h1>
<h1><a class="header" href="#contributing" id="contributing">Contributing</a></h1>
<h1><a class="header" href="#building-from-source" id="building-from-source">Building from Source</a></h1>
<h1><a class="header" href="#style-guide" id="style-guide">Style guide</a></h1>
<h1><a class="header" href="#architecutre" id="architecutre">Architecutre</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'G-JXXV25JQD2', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
